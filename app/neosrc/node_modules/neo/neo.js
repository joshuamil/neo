'use strict';

const path = require('path');
const fs = require('fs-extra');

const electron = require('electron');

const log = require('log');

const User = require('./User.js');
const Author = require('./Author.js');
const Story = require('./Story.js');

/**
 *  Main shared module for neo word processor.
 *
 *  @module neo
 */

var _neoRoot;

var _CurrentUser = null;

var _CurrentUser = null;

var _CurrentStory  = null;

var self = module.exports = {
  /** Class representing the neo user. There can be only one user, but a single
  user can have many Author profiles. */
  User,

  /** Class representing a neo author. */
  Author,

  /** Class representing a neo story. */
  Story,

  /** Current neo root folder. This is the container for all User, Author, and
  Story data. */
  get neoRoot() {
    return _neoRoot;
  },

  set neoRoot(newRoot) {
    _neoRoot = newRoot;
    log.debug('new neo root: ' + newRoot);
    loadRoot(_neoRoot);
  },

  /** Current active user profile. */
  get CurrentUser() {
    return _CurrentUser;
  },

  set CurrentUser(newUser) {
    _CurrentUser = newUser;

    fs.writeJsonSync(path.join(_neoRoot, '/user.nuf'), _CurrentUser);
  },

  /** Current active author profile. */
  get CurrentAuthor() {
    return _CurrentAuthor;
  },

  set CurrentAuthor(newAuthor) {
    _CurrentAuthor = newAuthor;
  },

  /** Current active story. */
  get CurrentStory() {
    return _CurrentStory;
  },

  set CurrentStory(newStory) {
    _CurrentStory = newStory;
  }
}

function loadRoot(root) {
  fs.ensureDirSync(root);
  try {
    _CurrentUser = fs.readJsonSync(path.join(root, '/user.nuf'));
  } finally {}
}
